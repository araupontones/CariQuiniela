)
clean_teams <- function(.data, var_name){
.data %>%
mutate({{var_name}} := as.character({{var_name}}),
{{var_name}} := case_when({{var_name}} == "USA" ~ "United States",
{{var_name}} == "Iran" ~ "IR Iran",
{{var_name}} == "South Korea" ~ "Korea Republic",
#teams fifa
{{var_name}} == "Antigua and Barbuda" ~ "Antigua",
{{var_name}} == "Bosnia and Herzegovina" ~ "Bosnia & Herz'na",
{{var_name}} == "Côte d'Ivoire" ~ "CÃ´te d'Ivoire",
T ~ {{var_name}})
)
}
rankings_clean <- rankings %>%
rename(team = country_full) %>%
clean_teams(.,team )
teams_fifa_clean <- sort(unique(rankings_clean$team))
setdiff(teams, teams_fifa_clean)
clean_teams <- function(.data, var_name){
.data %>%
mutate({{var_name}} := as.character({{var_name}}),
{{var_name}} := case_when({{var_name}} == "USA" ~ "United States",
{{var_name}} == "Iran" ~ "IR Iran",
{{var_name}} == "South Korea" ~ "Korea Republic",
#teams fifa
{{var_name}} == "Antigua and Barbuda" ~ "Antigua",
{{var_name}} == "Bosnia and Herzegovina" ~ "Bosnia & Herz'na",
{{var_name}} == "Côte d'Ivoire" ~ "CÃ´te d'Ivoire",
{{var_name}} == "Cape Verde Islands" ~ "Cape Verde",
T ~ {{var_name}})
)
}
rankings_clean <- rankings %>%
rename(team = country_full) %>%
clean_teams(.,team )
teams_fifa_clean <- sort(unique(rankings_clean$team))
setdiff(teams, teams_fifa_clean)
clean_teams <- function(.data, var_name){
.data %>%
mutate({{var_name}} := as.character({{var_name}}),
{{var_name}} := case_when({{var_name}} == "USA" ~ "United States",
{{var_name}} == "Iran" ~ "IR Iran",
{{var_name}} == "South Korea" ~ "Korea Republic",
#teams fifa
{{var_name}} == "Antigua and Barbuda" ~ "Antigua",
{{var_name}} == "Bosnia and Herzegovina" ~ "Bosnia & Herz'na",
{{var_name}} == "Côte d'Ivoire" ~ "CÃ´te d'Ivoire",
{{var_name}} == "Cape Verde Islands" ~ "Cape Verde",
{{var_name}} == "Central African Republic" ~ "CAR",
T ~ {{var_name}})
)
}
rankings_clean <- rankings %>%
rename(team = country_full) %>%
clean_teams(.,team )
teams_fifa_clean <- sort(unique(rankings_clean$team))
setdiff(teams, teams_fifa_clean)
clean_teams <- function(.data, var_name){
.data %>%
mutate({{var_name}} := as.character({{var_name}}),
{{var_name}} := case_when({{var_name}} == "USA" ~ "United States",
{{var_name}} == "Iran" ~ "IR Iran",
{{var_name}} == "South Korea" ~ "Korea Republic",
#teams fifa
{{var_name}} == "Antigua and Barbuda" ~ "Antigua",
{{var_name}} == "Bosnia and Herzegovina" ~ "Bosnia & Herz'na",
{{var_name}} == "Côte d'Ivoire" ~ "CÃ´te d'Ivoire",
{{var_name}} == "Cape Verde Islands" ~ "Cape Verde",
{{var_name}} == "Central African Republic" ~ "CAR",
{{var_name}} == "Curacao" ~ "CuraÃ§ao",
T ~ {{var_name}})
)
}
library(rio)
library(dplyr)
lookup <- import("data/3.clean/ind_all_matches.csv", encoding = "UTF-8")
rankings <- rio::import("fifa_rankings/fifa_ranking-2022-10-06.csv", encoding = "UTF-8")
#names of teams in lookup
locales <- unique(lookup$team)
visitantes <- unique(lookup$Opponent)
teams <- sort(unique(c(locales, visitantes)))
rankings_clean <- rankings %>%
rename(team = country_full) %>%
clean_teams(.,team )
teams_fifa_clean <- sort(unique(rankings_clean$team))
setdiff(teams, teams_fifa_clean)
clean_teams <- function(.data, var_name){
.data %>%
mutate({{var_name}} := as.character({{var_name}}),
{{var_name}} := case_when({{var_name}} == "USA" ~ "United States",
{{var_name}} == "Iran" ~ "IR Iran",
{{var_name}} == "South Korea" ~ "Korea Republic",
#teams fifa
{{var_name}} == "Antigua and Barbuda" ~ "Antigua",
{{var_name}} == "Bosnia and Herzegovina" ~ "Bosnia & Herz'na",
{{var_name}} == "Côte d'Ivoire" ~ "CÃ´te d'Ivoire",
{{var_name}} == "Cape Verde Islands" ~ "Cape Verde",
{{var_name}} == "Central African Republic" ~ "CAR",
{{var_name}} == "Curacao" ~ "CuraÃ§ao",
{{var_name}} == "Dominican Republic"~ "Dominican Rep.",
{{var_name}} == "Guinea"~ "Equ. Guinea",
{{var_name}} == "FYR Macedonia"  ~ "N. Macedonia",
T ~ {{var_name}})
)
}
rankings_clean <- rankings %>%
rename(team = country_full) %>%
clean_teams(.,team )
teams_fifa_clean <- sort(unique(rankings_clean$team))
setdiff(teams, teams_fifa_clean)
clean_teams <- function(.data, var_name){
.data %>%
mutate({{var_name}} := as.character({{var_name}}),
{{var_name}} := case_when({{var_name}} == "USA" ~ "United States",
{{var_name}} == "Iran" ~ "IR Iran",
{{var_name}} == "South Korea" ~ "Korea Republic",
#teams fifa
{{var_name}} == "Antigua and Barbuda" ~ "Antigua",
{{var_name}} == "Bosnia and Herzegovina" ~ "Bosnia & Herz'na",
{{var_name}} == "Côte d'Ivoire" ~ "CÃ´te d'Ivoire",
{{var_name}} == "Cape Verde Islands" ~ "Cape Verde",
{{var_name}} == "Central African Republic" ~ "CAR",
{{var_name}} == "Curacao" ~ "CuraÃ§ao",
{{var_name}} == "Dominican Republic"~ "Dominican Rep.",
{{var_name}} == "Guinea"~ "Equ. Guinea",
{{var_name}} == "FYR Macedonia"  ~ "N. Macedonia",
{{var_name}} == "Papua New Guinea" ~ "Papua NG",
{{var_name}} == "Republic of Ireland" ~ "Rep. of Ireland",
{{var_name}} == "São Tomé and Príncipe" ~ "SÃ£o TomÃ©",
{{var_name}} == "St. Kitts and Nevis" ~ "St. Kitts & Nevis",
{{var_name}} == "St. Vincent / Grenadines" ~ "St. Vincent",
{{var_name}} == "Trinidad and Tobago" ~ "Trin & Tobago",
{{var_name}} == "United Arab Emirates" ~ "UAE",
T ~ {{var_name}})
)
}
rankings_clean <- rankings %>%
rename(team = country_full) %>%
clean_teams(.,team )
teams_fifa_clean <- sort(unique(rankings_clean$team))
setdiff(teams, teams_fifa_clean)
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(mes = lubridate::month(Date))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(mes = lubridate::month(Date, label = TRUE))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = lubridate::quarter(Date))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = lubridate::quarter(Date, fiscal_start = 1))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = lubridate::quarter(Date, fiscal_start = 1,type = "year.quarter"))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = lubridate::quarter(Date, fiscal_start = 1,with_year = T))
class(rankings_clean$quarter)
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = as.character(lubridate::quarter(Date, fiscal_start = 1,with_year = T))
)
class(rankings_clean$quarter)
tabyl(rankings_clean, quarter)
janitor::tabyl(rankings_clean, quarter)
janitor::tabyl(rankings_clean, Month)
janitor::tabyl(rankings_clean, month)
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = as.character(lubridate::quarter(Date, fiscal_start = 1,with_year = T))
) %>%
filter(year >= 2011)
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = as.character(lubridate::quarter(Date, fiscal_start = 1,with_year = T))
) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(across(rank, total_points, previous_points), mean(~.x))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = as.character(lubridate::quarter(Date, fiscal_start = 1,with_year = T))
) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(across(rank, total_points, previous_points), function(x)mean(x))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = as.character(lubridate::quarter(Date, fiscal_start = 1,with_year = T))
) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(rank = mean(rank))
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = as.character(lubridate::quarter(Date, fiscal_start = 1,with_year = T))
) %>%
filter(year >= 2011) %>%
group_by(team, quarter)
summarise(rank = mean(rank),
total_points = mean(total_points),
previous_points = mean(previous_points)
)
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
mutate(month = lubridate::month(Date, label = TRUE),
year = lubridate::year(Date),
quarter = as.character(lubridate::quarter(Date, fiscal_start = 1,with_year = T))
) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(rank = mean(rank),
total_points = mean(total_points),
previous_points = mean(previous_points)
)
create_quarter <- function(.data, date){
.data %>%
mutate(mutate(month = lubridate::month(date, label = TRUE),
year = lubridate::year(date),
quarter = as.character(lubridate::quarter(date, fiscal_start = 1,with_year = T))
))
}
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
create_date(., Date) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(rank = mean(rank),
total_points = mean(total_points),
previous_points = mean(previous_points)
)
create_quarter <- function(.data, date){
.data %>%
mutate(mutate(month = lubridate::month(date, label = TRUE),
year = lubridate::year(date),
quarter = as.character(lubridate::quarter(date, fiscal_start = 1,with_year = T))
))
}
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
create_quarter(., Date) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(rank = mean(rank),
total_points = mean(total_points),
previous_points = mean(previous_points)
)
create_quarter <- function(.data, date){
.data %>%
mutate(mutate(month = lubridate::month({{date}}, label = TRUE),
year = lubridate::year({{date}}),
quarter = as.character(lubridate::quarter({{date}}, fiscal_start = 1,with_year = T))
))
}
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
create_quarter(., Date) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(rank = mean(rank),
total_points = mean(total_points),
previous_points = mean(previous_points)
)
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
create_quarter(., Date)
create_quarter <- function(.data, date){
.data %>%
mutate(month = lubridate::month({{date}}, label = TRUE),
year = lubridate::year({{date}}),
quarter = as.character(lubridate::quarter({{date}}, fiscal_start = 1,with_year = T))
)
}
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
create_quarter(., Date)
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
create_quarter(., Date) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(rank = mean(rank),
total_points = mean(total_points),
previous_points = mean(previous_points)
)
rankings_clean <- rankings %>%
rename(team = country_full,
Date = rank_date) %>%
clean_teams(.,team ) %>%
create_quarter(., Date) %>%
filter(year >= 2011) %>%
group_by(team, quarter) %>%
summarise(rank = mean(rank),
total_points = mean(total_points),
previous_points = mean(previous_points),
.groups = 'drop'
)
odds <- rio::import("data/3.clean/ind_ods_winner.csv")
#check correlation with odds
last_ranking <- teams_fifa_clean %>% filter(quarter == "2022.4")
#check correlation with odds
last_ranking <- teams_fifa_clean %>% dplyr::filter(quarter == "2022.4")
#check correlation with odds
last_ranking <- rankings_clean %>% dplyr::filter(quarter == "2022.4")
data_plot <- odds %>% left_join(last_ranking)
View(data_plot)
library(ggplot2)
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points)) +
geom_point()
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points)) +
geom_point() +
geom_line()
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points)) +
geom_point() +
geom_smooth()
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points,
label = team)) +
geom_point() +
geom_smooth
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points,
label = team)) +
geom_point() +
geom_smooth()+
geom_text()
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points,
label = team)) +
geom_point() +
geom_smooth()+
geom_text(position=position_jitter(width=1,height=1))
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel()
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel() +
labs(x = "odds to win",
y = "fifa points")
data_plot <- odds
data_plot <- odds %>%
arrange(odd_win)
data_plot <- odds %>%
arrange(odd_win) %>%
mutate(ranking_ods = row_number())
data_plot <- odds %>%
arrange(odd_win) %>%
mutate(ranking_ods = row_number()) %>%
left_join(last_ranking)
data_plot %>%
ggplot(aes(x = ranking_ods,
y = rank,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel() +
labs(x = "odds to win",
y = "fifa points")
#by odds
data_plot %>%
ggplot(aes(x = ranking_ods,
y = rank,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel() +
labs(x = "odds to win",
y = "fifa points",
title = "Ranking odds vs Ranking Fifa")
#by points
#by odds
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel() +
labs(x = "odds to win",
y = "fifa points",
title = "Odds to win vs Total points FIFA")
#by odds
data_plot %>%
ggplot(aes(x = ranking_ods,
y = rank,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel() +
labs(x = "Rank Odds",
y = "Rank Fifa",
title = "Ranking odds vs Ranking Fifa")
#by points
#by odds
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel() +
labs(x = "odds to win",
y = "fifa points",
title = "Odds to win vs Total points FIFA")
#by points
#by odds
data_plot %>%
ggplot(aes(x = odd_win,
y = total_points,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel() +
labs(x = "odds to win",
y = "fifa points",
title = "Odds to win vs Total points FIFA")
#by odds
data_plot %>%
ggplot(aes(x = ranking_ods,
y = rank,
label = team)) +
geom_point() +
geom_smooth()+
ggrepel::geom_text_repel() +
labs(x = "Rank Odds",
y = "Rank Fifa",
title = "Ranking odds vs Ranking Fifa")
