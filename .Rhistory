odds_ind %>%
ggplot(aes(y = reorder(team, odd_win),
x = odd_win)) +
geom_col() +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
)
exchart <- 'charts/exploratory/odds_win.png'
#inspect data
chart <- odds_ind %>%
ggplot(aes(y = reorder(team, odd_win),
x = odd_win)) +
geom_col() +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
)
export(odds_ind, exfile)
ggsave(exchart, chart)
url <- "https://www.vegasinsider.com/soccer/odds/world-cup/"
url <- "https://www.vegasinsider.com/soccer/odds/world-cup/"
library(rvest)
url <- "https://www.vegasinsider.com/soccer/odds/world-cup/"
website <- read_html()
website <- read_html(url)
url <- "https://www.vegasinsider.com/soccer/world-cup/group/a/"
website <- read_html(url) %>%
html_elements("figure")
website
website <- read_html(url) %>%
html_elements("figure") %>%
html_elements(".two-column-table")
website
website <- read_html(url) %>%
html_elements("figure") %>%
html_elements(".wp-block-table")
website <- read_html(url) %>%
#html_elements("figure") %>%
html_elements(".wp-block-table")
website
website <- read_html(url) %>%
#html_elements("figure") %>%
html_elements(".wp-block-table") %>%
html_table()
website[[1]]
table_dirty <- read_html(url) %>%
#html_elements("figure") %>%
html_elements(".wp-block-table") %>%
html_table()
names(table_dirty) <- as.character(table_dirty[1,])
table_dirty <- read_html(url) %>%
#html_elements("figure") %>%
html_elements(".wp-block-table") %>%
html_table() %>%
.[[1]]
names(table_dirty) <- as.character(table_dirty[1,])
names(table_dirty)
table_dirty
table_dirty <- table_dirty[-1,]
table_dirty
c("a":"h")
letters
letters[1:8]
groups <- letters[1:8]
url_wc <- "https://www.vegasinsider.com/soccer/world-cup/group"
list_groups <- lapply(groups, function(g){
url_wc <- "https://www.vegasinsider.com/soccer/world-cup/group"
url_group <- file.path(url_wc, g)
print(url_group)
})
list_groups <- lapply(groups, function(g){
message(paste("grupo", g))
url_wc <- "https://www.vegasinsider.com/soccer/world-cup/group"
url_group <- file.path(url_wc, g)
table_dirty <- read_html(url_group) %>%
#html_elements("figure") %>%
html_elements(".wp-block-table") %>%
html_table() %>%
.[[1]]
#set first row as name columns
names(table_dirty) <- as.character(table_dirty[1,])
table_dirty <- table_dirty[-1,]
table_dirty
})
data_groups <- do.call(rbind, list_groups)
View(data_groups)
exfile <- file.path(exdir, "odds_groups.csv")
exdir <- "data/2.scrapped/vegasinsider"
exfile <- file.path(exdir, "odds_groups.csv")
names(data_groups)
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(gsub," ", "_",.)
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(~ gsub," ", "_",.x)
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(~ gsub," ", "_",.)
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")})
names(data_groups)
library(stringr)
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")}) %>%
mutate(across(matches("Group"), ~str_remove(x,"+")))
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")}) %>%
mutate(across(matches("Group"), ~str_remove(.)))
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")}) %>%
mutate(across(matches("Group"), ~str_remove(.x, "+")))
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")}) %>%
mutate(across(matches("Group"), ~str_remove(.x, "//+")))
View(data_groups)
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")}) %>%
mutate(across(matches("Group"), ~str_remove(.x, "\\+")))
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")}) %>%
mutate(across(matches("Group"), ~ as.numeric(str_remove(.x, "\\+"))))
list_groups <- lapply(groups, function(g){
message(paste("grupo", g))
url_wc <- "https://www.vegasinsider.com/soccer/world-cup/group"
url_group <- file.path(url_wc, g)
table_dirty <- read_html(url_group) %>%
#html_elements("figure") %>%
html_elements(".wp-block-table") %>%
html_table() %>%
.[[1]] %>%
mutate(grupo = g)
#set first row as name columns
names(table_dirty) <- as.character(table_dirty[1,])
table_dirty <- table_dirty[-1,]
table_dirty
})
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")}) %>%
mutate(across(matches("Group"), ~ as.numeric(str_remove(.x, "\\+"))))
#append all groups
data_groups <- do.call(rbind, list_groups)
#append all groups
data_groups <- do.call(rbind, list_groups)
View(list_groups)
list_groups <- lapply(groups, function(g){
message(paste("grupo", g))
url_wc <- "https://www.vegasinsider.com/soccer/world-cup/group"
url_group <- file.path(url_wc, g)
table_dirty <- read_html(url_group) %>%
#html_elements("figure") %>%
html_elements(".wp-block-table") %>%
html_table() %>%
.[[1]]
#set first row as name columns
names(table_dirty) <- as.character(table_dirty[1,])
table_dirty <- table_dirty[-1,]
table_dirty$grupo = g
table_dirty
})
#append all groups
data_groups <- do.call(rbind, list_groups)
#append all groups
data_groups <- do.call(rbind, list_groups) %>%
rename_all(function(x){stringr::str_replace_all(x," ","_")}) %>%
mutate(across(matches("Group"), ~ as.numeric(str_remove(.x, "\\+"))))
rio::export(data_groups, exfile)
library(tidyr)
infile <- file.path(exdir, "odds_groups.csv")
indir <- "data/2.scrapped/vegasinsider"
indir <- "data/2.scrapped/vegasinsider"
infile <- file.path(exdir, "odds_groups.csv")
exdir <- 'data/3.clean'
exfile <- file.path(exdir, "ind_ods_groups.csv")
#read data ---------------------------------------------------------------------
lookup <- rio::import('data/1.lookups/teams_urls.csv')
odds_raw <- import(infile)
#check that the countries match the lookup table ------------------------------
countries <-  lookup$team
setdiff(odds_raw$country, countries)
#check that the countries match the lookup table ------------------------------
countries <-  lookup$team
odds_raw <- import(infile)
names(odds_raw)
#check that the countries match the lookup table ------------------------------
countries <-  lookup$Team
setdiff(odds_raw$country, countries)
#check that the countries match the lookup table ------------------------------
countries <-  lookup$team
setdiff(odds_raw$Team, countries)
setdiff(countries, odds_raw$Team)
setdiff(odds_raw$Team, countries)
odds_clean <- odds_raw %>%
rename(team = country) %>%
mutate(team = case_when(team == "USA" ~ "United States",
T ~ team
))
odds_clean <- odds_raw %>%
rename(team = Team) %>%
mutate(team = case_when(team == "USA" ~ "United States",
T ~ team
))
setdiff(odds_raw$team, countries)
countries
setdiff(odds_clean$team, countries)
View(odds_clean)
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
pivot_longer(-c(team, grupo))
View(chart)
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd")
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = reorder(team, ind),
x = odd,
fill = ind)) +
geom_col() +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = reorder(team, ind),
x = odd,
fill = ind)) +
geom_col() +
facet_wrap(~grupo)
chart
?facet_wrap
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = reorder(team, ind),
x = odd,
fill = ind)) +
geom_col() +
facet_wrap(~grupo, scales = "free_y")
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = reorder(team, ind),
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
facet_wrap(~grupo, scales = "free_y") +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
facet_wrap(~grupo, scales = "free_y") +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, -Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
facet_wrap(~grupo, scales = "free_y") +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, -Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
facet_wrap(~grupo, scales = "free_y", ncol = 2) +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, -Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
facet_wrap(~grupo, scales = "free_y", ncol = 2) +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
legend.position = "top"
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, -Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
geom_vline(xintercept = 0)+
facet_wrap(~grupo, scales = "free_y", ncol = 2) +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
legend.position = "top"
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, -Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
geom_vline(xintercept = 0,
size = 1)+
facet_wrap(~grupo, scales = "free_y", ncol = 2) +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
legend.position = "top"
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, -Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
geom_vline(xintercept = 0,
size = 1)+
facet_wrap(~grupo, scales = "free_y", ncol = 2) +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
legend.position = "top",
legend.title = element_blank()
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, -Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
geom_vline(xintercept = 0,
size = 1)+
facet_wrap(~grupo, scales = "free_y", ncol = 2) +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
legend.position = "top",
legend.title = element_blank(),
strip.text = element_text(face = "bold")
)
chart
#inspect data-------------------------------------------------------------------
chart <- odds_clean %>%
mutate(team = forcats::fct_reorder(team, -Group_Winner)) %>%
pivot_longer(-c(team, grupo),
names_to = "ind",
values_to = "odd") %>%
ggplot(aes(y = team,
x = odd,
fill = ind)) +
geom_col(position = 'dodge') +
geom_vline(xintercept = 0,
size = 1)+
facet_wrap(~grupo, scales = "free_y", ncol = 2) +
labs(x = "Odds to win WC",
y = "") +
theme(axis.text.y = element_text(hjust = 0),
axis.ticks = element_blank() ,
panel.background = element_blank(),
plot.background = element_blank(),
panel.grid.major.x = element_line(linetype = "dotted", color = "black"),
panel.grid.minor.x = element_line(linetype = "dotted", color = "black"),
legend.position = "top",
legend.title = element_blank(),
strip.text = element_text(face = "bold", size = 12)
)
chart
exfile
exchart
exchart <- 'charts/exploratory/odds_groups.png'
exchart
#export =======================================================================
export(odds_clean, exfile)
ggsave(exchart, chart)
